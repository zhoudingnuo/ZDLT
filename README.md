# 智大蓝图 - AI智能体聚合平台

## 项目概述

智大蓝图（ZETA VISTA）是一个基于React + Node.js的AI智能体聚合平台，提供多种智能体服务，包括教育辅助、代码测试、文档处理、图像识别等功能。

## 技术栈

### 前端
- **React 18.2.0** - 用户界面框架
- **Ant Design 5.13.1** - UI组件库
- **Axios 1.6.8** - HTTP客户端

### 后端
- **Node.js** - 服务器运行环境
- **Express 4.19.2** - Web应用框架
- **CORS 2.8.5** - 跨域资源共享
- **Axios 1.6.8** - HTTP客户端

## 项目结构

```
OT/
├── frontend/                 # 前端项目
│   ├── public/              # 静态资源
│   │   ├── index.html       # HTML模板
│   │   ├── logo-zeta-vista.png  # 项目Logo
│   │   └── favicon.ico      # 网站图标
│   ├── src/
│   │   ├── App.jsx          # 主应用组件
│   │   └── index.js         # 应用入口
│   ├── package.json         # 前端依赖配置
│   └── README.md            # 前端说明文档
├── backend/                  # 后端项目
│   ├── app.js               # 服务器主文件
│   ├── agents.json          # 智能体配置
│   ├── package.json         # 后端依赖配置
│   └── logo.jpg             # 后端Logo
├── deploy/                   # 部署相关文档
│   ├── deploy-guide.md      # 云服务器部署指南
│   ├── cloud-platform-guide.md # 云平台部署指南
│   ├── ngrok-guide.md       # 内网穿透部署指南
│   └── quick-deploy.bat     # 快速部署脚本
├── start-all.bat            # 一键启动脚本（英文版）
├── start-all-cn.bat         # 一键启动脚本（中文版，CMD）
├── start-all-cn.cmd         # 一键启动脚本（中文版，兼容PowerShell）
├── start-all-cn.ps1         # 一键启动脚本（中文版，PowerShell）
└── README.md                # 项目主文档
```

## 功能特性

### 智能体服务
平台集成了多种AI智能体，涵盖以下领域：

#### 教育辅助
- **语文课文默写批改** - 对比默写原文，批改学生默写内容
- **数学批改** - 数学作业智能批改
- **英语课文写批改** - 英语课文写作智能批改
- **高中英语作文批改** - 高中英语作文智能批改
- **高中语文作文批改** - 高中语文作文智能批改
- **语文课文同步作文批改** - 语文课文同步作文智能批改
- **语文文件文批改** - 语文文件智能批改

#### 技术工具
- **代码测试工具** - 代码测试与调试
- **代码测试** - 代码测试功能
- **文字识别** - 图片文字识别（OCR）

#### 内容处理
- **音视频转文字** - 音视频内容转文字
- **图生图** - 图片生成与处理
- **单词随机曲** - 单词随机生成与测试

#### 商业应用
- **营销稿回复** - 营销稿件智能回复
- **家长通知** - 家长通知自动生成
- **梦想职业** - 职业规划与梦想探索

### 用户界面特性
- **现代化设计** - 采用渐变色彩和卡片式布局
- **响应式布局** - 适配不同屏幕尺寸
- **智能体卡片** - 彩色卡片展示，支持悬停效果
- **聊天界面** - 支持多轮对话的聊天界面
- **搜索功能** - 智能体搜索和筛选
- **分类展示** - 热门推荐和全部智能体分类
- **用户系统** - 登录/注册功能，用户状态管理

### 用户系统功能
- **用户登录/注册** - 模态框形式的用户认证
- **用户状态管理** - 本地存储用户信息
- **用户头像** - 右上角用户头像，支持下拉菜单
- **登录状态显示** - 显示用户名或"未登录"状态
- **退出登录** - 清除用户信息并返回未登录状态
- **用户管理** - 管理员可查看所有用户信息（用户名、邮箱、注册时间、最后登录时间、角色等）
- **权限控制** - 只有管理员登录后才显示"用户管理"入口

### 历史对话功能
- **本地存储** - 历史对话保存在浏览器本地存储中
- **对话切换** - 支持在历史对话间切换，保持对话内容
- **对话删除** - 支持删除不需要的历史对话
- **URL路由** - 每个对话都有独立的URL（如`/chat/:id`），刷新页面不会丢失
- **新对话** - 点击"新对话"按钮或Logo可回到首页

### 智能体管理
- **配置状态** - 卡片显示"已配置/待配置"状态Tag
- **分类管理** - 支持多个分类Tab（作文&批改、AI教学等）
- **排序规则** - 已配置的智能体排在前面，未配置的排在后面
- **搜索筛选** - 支持按名称搜索智能体

### 技术特性
- **Markdown渲染** - 支持完整的Markdown语法，包括表格、图片、代码块等
- **表格优化** - 自动修正伪表格格式，支持标准Markdown表格
- **图片处理** - 图片输出前自动换行，美化样式
- **实时计时** - AI回答时显示实时计时器，回答完成后显示总用时
- **网络诊断** - 内置网络连接诊断工具
- **主题切换** - 支持浅色/深色主题切换
- **外网访问** - 支持外网访问模式，端口31001

## 最新更新

### 2025-01-30 错误修复
- **修复用户管理错误** - 解决了`userListVisible is not defined`错误
- **Context优化** - 完善了UserListContext的使用，确保用户管理功能正常工作
- **Dify工作流修复** - 修复了`"im is required in input form"`错误，将字段名从`image`改为`im`
- **一键配置** - 创建了多种一键启动脚本，兼容PowerShell和CMD环境
- **文档更新** - 更新了README文档，添加了详细的使用说明

### 2025-01-29 功能优化
- **用户管理完善** - 修复了"最后登录"时间显示问题
- **历史对话优化** - 改进了历史对话的保存和切换逻辑
- **UI细节优化** - 优化了聊天界面、表格渲染、图片显示等
- **路由系统** - 实现了完整的React Router路由系统

## 安装与运行

### 环境要求
- Node.js 14.0+
- npm 6.0+

### 一键配置启动（推荐）

我们提供了多种一键启动脚本，兼容不同的Windows环境：

#### 方式一：CMD批处理脚本（最兼容）
```bash
# 双击运行
start-all-cn.cmd
```

#### 方式二：PowerShell脚本（推荐）
```bash
# 右键选择"使用PowerShell运行"
start-all-cn.ps1
```

#### 方式三：传统批处理脚本
```bash
# 双击运行
start-all-cn.bat
```

### 手动启动

1. **克隆项目**
```bash
git clone <项目地址>
cd OT
```

2. **安装依赖**
```bash
# 安装后端依赖
cd backend
npm install

# 安装前端依赖
cd ../frontend
npm install
```

3. **启动服务**
```bash
# 启动后端（端口5000）
cd backend
npm start

# 启动前端（端口31001，支持外网访问）
cd frontend
npm run start-external
```

### 访问地址
- **前端应用**: http://localhost:31001
- **后端API**: http://localhost:5000

## 外网部署

### 快速部署工具
我们提供了便捷的部署工具，支持多种部署方式：

```bash
# 运行快速部署脚本
双击 deploy/quick-deploy.bat
```

### 部署方式选择

#### 1. 内网穿透（快速测试）
- **适用场景**: 临时演示、快速测试
- **推荐工具**: ngrok
- **优点**: 无需服务器，即开即用
- **缺点**: 域名随机，连接数限制
- **成本**: 免费

#### 2. 云平台部署（推荐新手）
- **适用场景**: 个人项目、小型应用
- **推荐平台**: Vercel + Railway
- **优点**: 简单易用，自动部署
- **缺点**: 功能限制，成本随使用量增加
- **成本**: $5-25/月

#### 3. 云服务器部署（专业方案）
- **适用场景**: 商业应用、大型项目
- **推荐平台**: 阿里云/腾讯云/华为云
- **优点**: 完全控制，性能优秀
- **缺点**: 配置复杂，需要运维
- **成本**: $20-100/月

### 详细部署指南

#### 内网穿透部署
参考: `deploy/ngrok-guide.md`
- 下载安装ngrok
- 配置authtoken
- 启动隧道服务
- 修改前端API地址

#### 云平台部署
参考: `deploy/cloud-platform-guide.md`
- Vercel部署前端
- Railway部署后端
- 配置环境变量
- 设置自定义域名

#### 云服务器部署
参考: `deploy/deploy-guide.md`
- 购买云服务器
- 配置环境
- 部署应用
- 配置Nginx反向代理
- 设置SSL证书

### 部署检查清单

#### 基础配置
- [ ] 环境变量配置正确
- [ ] API地址更新为生产环境
- [ ] CORS配置允许生产域名
- [ ] 数据库连接配置（如有）

#### 安全配置
- [ ] HTTPS证书配置
- [ ] 防火墙规则设置
- [ ] API密钥安全存储
- [ ] 访问日志监控

#### 性能优化
- [ ] 静态资源压缩
- [ ] CDN配置
- [ ] 缓存策略设置
- [ ] 数据库优化

## API接口

### 后端API
- `GET /api/agents` - 获取智能体列表
- `POST /api/agent/:id/invoke` - 调用指定智能体

### 智能体配置
智能体配置存储在 `backend/agents.json` 文件中，包含：
- `id` - 智能体唯一标识
- `name` - 智能体名称
- `description` - 智能体描述
- `apiUrl` - API接口地址
- `apiKey` - API密钥（敏感信息，不返回给前端）

## 开发说明

### 前端开发
- 使用React Hooks进行状态管理
- 采用Ant Design组件库构建UI
- 支持代理配置，开发时自动转发API请求
- 用户状态本地存储管理

### 后端开发
- Express框架提供RESTful API
- 支持CORS跨域请求
- 智能体配置通过JSON文件管理

### 样式设计
- 主色调：蓝色渐变 (#4f8cff → #6f6fff)
- 卡片阴影：rgba(79,140,255,0.08)
- 字体：PingFang SC, Microsoft YaHei, Arial, sans-serif

## 部署说明

### 生产环境部署
1. 构建前端项目
```bash
cd frontend
npm run build
```

2. 配置后端环境变量
3. 使用PM2或Docker进行部署

### 注意事项
- 确保API密钥安全存储
- 配置适当的CORS策略
- 设置生产环境的端口和域名

## 监控和维护

### 服务监控
- 使用PM2监控Node.js进程
- 配置Nginx访问日志
- 设置错误告警
- 监控服务器资源使用

### 日志管理
- 配置日志轮转
- 设置日志级别
- 定期分析访问日志
- 配置错误日志收集

### 备份策略
- 定期备份代码
- 备份配置文件
- 备份数据库（如有）
- 测试恢复流程

## 故障排除

### 常见问题

#### 1. 端口被占用
```bash
# 查看端口占用
netstat -ano | findstr :5000
netstat -ano | findstr :31001

# 结束占用进程
taskkill /PID [进程ID] /F
```

#### 2. API请求失败
- 检查后端服务是否启动
- 确认API地址配置正确
- 查看CORS配置
- 检查网络连接

#### 3. 部署失败
- 检查环境变量配置
- 确认依赖安装完整
- 查看部署日志
- 验证服务器配置

### 性能优化建议

#### 前端优化
- 启用代码分割
- 配置静态资源缓存
- 使用CDN加速
- 优化图片大小

#### 后端优化
- 启用Gzip压缩
- 配置数据库连接池
- 使用Redis缓存
- 优化API响应时间

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交代码变更
4. 发起Pull Request

## 许可证

本项目采用MIT许可证。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件
- 加入讨论群

## 更新日志

### v1.2.0 - 外网部署支持
- 添加多种外网部署方案
- 提供快速部署工具
- 完善部署文档
- 优化部署流程

### v1.1.0 - 网络访问支持
- 添加局域网访问支持
- 配置CORS跨域访问
- 优化启动脚本
- 添加网络访问说明文档

### v1.0.0 - 初始版本
- 基础功能实现
- 智能体集成
- 用户界面设计
- 核心API开发

## 2024-06-30 更新说明

### 功能修复
- 修复了头像登录Dropdown和Tooltip重叠导致的UI问题
- 修复了课文默写批改模块的SSE数据流解析问题
- 修复了Invalid Host header问题，支持外网访问
- 修复了批处理脚本的中文编码问题

### 启动脚本
现在提供两个版本的启动脚本：
- `start-all.bat` - 英文版本，兼容性更好
- `start-all-cn.bat` - 中文版本，界面更友好

### 使用方法
```bash
# 方式1：使用英文版启动脚本（推荐）
双击 start-all.bat

# 方式2：使用中文版启动脚本
双击 start-all-cn.bat

# 方式3：手动启动
cd backend && npm start
cd frontend && npm run start-network
```

## 前端开发规范

- 智能体根据输入方式分为两类：参数上传类（如语文作文批改、语文课文默写批改、单词消消乐）和智能对话类（如智能问答助手）。
- 前端对话页面需根据输入方式的不同，分别渲染"开始"按钮（参数上传类）和类似智能问答助手的对话框、深度思考按钮等（智能对话类）。

## 项目简介
本项目为AI智能体聚合平台，支持多智能体管理、API转发、用户管理、充值审核、文件上传等功能，前后端分离，安全高效。

## 目录结构
```
OT/
  backend/         # 后端Node.js服务
  frontend/        # 前端React应用
  deploy/          # 部署与运维文档
  photo/           # 示例图片
  ...
```

## 主要功能
- 智能体管理与API转发
- 用户注册、登录、消耗统计、余额管理
- 管理员权限与充值审核
- 文件/图片上传与转存
- 安全加密与日志

## 环境变量
详见 `.env.example`，支持PORT、API_BASE、REACT_APP_API_BASE等配置。

## 启动方式
### 后端
```
cd backend
npm install
npm start
```
### 前端
```
cd frontend
npm install
npm start
```

## 开发规范
- 代码风格统一（Prettier/ESLint）
- API返回结构统一（success/data/error）
- 密码加密存储与传输
- 重要操作与异常写日志
- 配置集中管理，敏感信息不硬编码

## 安全说明
- 密码全流程加密（前端SHA-256，后端bcrypt）
- 管理员接口权限校验
- 日志分级存储
- 依赖安全升级

## 常见问题
- 启动报错：检查依赖和环境变量
- API连接失败：检查API_BASE配置和网络
- 登录失败：确认密码加密流程一致

## 贡献与测试
- 建议使用Jest/Supertest/Cypress等进行自动化测试
- 欢迎PR和Issue

## 许可证
MIT 