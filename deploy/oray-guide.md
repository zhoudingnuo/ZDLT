# 花生壳内网穿透部署指南

## 花生壳简介

花生壳（Oray）是国内知名的内网穿透服务提供商，提供稳定可靠的内网穿透解决方案，特别适合国内用户使用。

### 优势特点
- **国内服务**：服务器在国内，访问速度快
- **稳定可靠**：服务稳定性好，支持率高
- **简单易用**：图形化界面，配置简单
- **免费额度**：提供免费版本，满足基本需求
- **技术支持**：中文客服支持

## 注册和下载

### 1. 注册账号
1. 访问 [花生壳官网](https://www.oray.com/)
2. 点击"注册"创建账号
3. 验证邮箱和手机号
4. 登录花生壳控制台

### 2. 下载客户端
1. 访问 [下载页面](https://www.oray.com/download/)
2. 选择Windows版本下载
3. 安装花生壳客户端
4. 使用账号登录客户端

## 配置内网穿透

### 1. 启动本地服务

#### 启动后端服务
```bash
cd backend
npm start
```

#### 启动前端服务
```bash
cd frontend
npm run start-network
```

### 2. 配置花生壳映射

#### 后端API映射配置
1. 打开花生壳客户端
2. 点击"内网穿透"
3. 点击"添加映射"
4. 配置参数：
   - **应用名称**: 智大蓝图后端
   - **内网主机**: 127.0.0.1
   - **内网端口**: 5000
   - **协议类型**: HTTP
   - **外网端口**: 自动分配
   - **外网域名**: 自动分配

#### 前端应用映射配置
1. 再次点击"添加映射"
2. 配置参数：
   - **应用名称**: 智大蓝图前端
   - **内网主机**: 127.0.0.1
   - **内网端口**: 31001
   - **协议类型**: HTTP
   - **外网端口**: 自动分配
   - **外网域名**: 自动分配

### 3. 获取外网地址

配置完成后，花生壳会提供类似以下的外网地址：
- **后端API**: `http://your-app-name.vicp.net:port`
- **前端应用**: `http://your-app-name2.vicp.net:port`

## 修改前端配置

### 1. 更新API地址

#### 方法一：修改代码
在 `frontend/src/App.jsx` 中修改API地址：

```javascript
// 将原来的地址
const API_BASE_URL = 'http://localhost:5000';

// 修改为花生壳后端地址
const API_BASE_URL = 'http://your-backend-app.vicp.net:port';
```

#### 方法二：使用环境变量
创建 `frontend/.env` 文件：

```bash
REACT_APP_API_URL=http://your-backend-app.vicp.net:port
```

### 2. 重新构建前端
```bash
cd frontend
npm run build
```

## 一键启动脚本

### 创建启动脚本
创建 `deploy/start-oray.bat` 文件：

```batch
@echo off
chcp 65001 >nul
title 智大蓝图 - 花生壳内网穿透启动工具

echo ========================================
echo        智大蓝图花生壳内网穿透启动工具
echo ========================================
echo.

echo 步骤1: 启动后端服务...
cd backend
start "智大蓝图后端" cmd /k "npm start"
cd ..

echo 等待后端服务启动...
timeout /t 5 /nobreak >nul

echo.
echo 步骤2: 启动前端服务...
cd frontend
start "智大蓝图前端" cmd /k "npm run start-network"
cd ..

echo.
echo 步骤3: 启动花生壳客户端...
echo 请手动启动花生壳客户端并配置映射
echo.
echo 映射配置说明：
echo.
echo 后端API映射：
echo - 应用名称: 智大蓝图后端
echo - 内网主机: 127.0.0.1
echo - 内网端口: 5000
echo - 协议类型: HTTP
echo.
echo 前端应用映射：
echo - 应用名称: 智大蓝图前端
echo - 内网主机: 127.0.0.1
echo - 内网端口: 31001
echo - 协议类型: HTTP
echo.
echo 配置完成后，您将获得外网访问地址
echo 记得修改前端API地址为花生壳后端地址
echo.
pause
```

### 使用启动脚本
```bash
# 双击运行
双击 deploy/start-oray.bat
```

## 花生壳版本对比

### 免费版
- **映射数量**: 2个
- **带宽限制**: 1Mbps
- **连接数**: 100个
- **域名**: 随机分配
- **价格**: 免费

### 付费版
- **映射数量**: 不限
- **带宽限制**: 10Mbps-100Mbps
- **连接数**: 1000-10000个
- **域名**: 可自定义
- **价格**: ¥99-999/年

## 配置优化

### 1. 花生壳客户端设置
- **开机自启**: 勾选开机自动启动
- **最小化到托盘**: 避免意外关闭
- **自动重连**: 网络断开时自动重连

### 2. 映射配置优化
- **协议选择**: 根据应用选择HTTP/HTTPS/TCP
- **端口配置**: 建议使用自动分配端口
- **域名设置**: 付费版可设置自定义域名

### 3. 安全配置
- **访问控制**: 设置访问密码
- **IP白名单**: 限制访问IP范围
- **日志监控**: 定期查看访问日志

## 故障排除

### 1. 连接失败
```bash
# 检查本地服务是否启动
netstat -ano | findstr :5000
netstat -ano | findstr :31001

# 检查花生壳客户端状态
# 查看客户端连接状态
# 检查网络连接
```

### 2. 外网无法访问
- 确认花生壳映射配置正确
- 检查本地防火墙设置
- 验证花生壳客户端在线状态
- 查看花生壳控制台日志

### 3. API请求失败
- 确认前端API地址配置正确
- 检查CORS配置
- 验证后端服务正常运行
- 查看浏览器控制台错误

### 4. 性能问题
- 升级到付费版获得更高带宽
- 优化应用代码减少请求量
- 使用CDN加速静态资源
- 配置缓存策略

## 监控和维护

### 1. 服务监控
- 定期检查花生壳客户端状态
- 监控映射连接状态
- 查看访问日志和统计
- 设置异常告警

### 2. 日志管理
- 查看花生壳访问日志
- 分析访问模式和流量
- 监控异常访问行为
- 定期清理日志文件

### 3. 备份策略
- 备份花生壳配置信息
- 记录映射配置参数
- 保存外网访问地址
- 定期测试连接状态

## 成本估算

### 免费版
- **花生壳服务**: 免费
- **域名费用**: 免费（随机域名）
- **维护成本**: 时间成本
- **总计**: 免费

### 付费版
- **花生壳服务**: ¥99-999/年
- **自定义域名**: ¥50-200/年
- **SSL证书**: ¥100-500/年
- **总计**: ¥249-1699/年

## 与其他方案对比

| 方案 | 优点 | 缺点 | 成本 | 推荐指数 |
|------|------|------|------|----------|
| 花生壳 | 国内服务、稳定、易用 | 免费版限制多 | 免费-¥999/年 | ⭐⭐⭐⭐⭐ |
| ngrok | 全球服务、功能强大 | 国外服务、速度慢 | 免费-$8/月 | ⭐⭐⭐⭐ |
| frp | 完全免费、可自建 | 配置复杂、需服务器 | 服务器费用 | ⭐⭐⭐ |
| 云服务器 | 稳定可靠、性能好 | 成本高、配置复杂 | $20-100/月 | ⭐⭐⭐⭐⭐ |

## 使用建议

### 1. 适用场景
- **个人项目**: 免费版足够使用
- **小型团队**: 付费版提供更好体验
- **演示测试**: 快速搭建外网访问
- **临时部署**: 无需购买服务器

### 2. 最佳实践
- 使用开机自启动确保服务稳定
- 定期检查连接状态
- 配置访问日志监控
- 及时更新客户端版本

### 3. 升级建议
- 免费版试用1-2个月
- 根据使用情况选择付费版
- 考虑长期使用云服务器方案
- 评估成本和性能需求

## 总结

花生壳是智大蓝图应用快速部署到外网的优秀选择，特别适合：

1. **快速测试**: 免费版即可满足基本需求
2. **个人项目**: 成本低，配置简单
3. **国内用户**: 访问速度快，服务稳定
4. **临时部署**: 无需购买服务器

按照本指南操作，您就可以快速使用花生壳将智大蓝图应用部署到外网了！ 