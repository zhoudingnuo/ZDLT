# 花生壳快速配置指南

## 当前状态
✅ 后端服务已启动：http://localhost:5000  
✅ 前端服务已启动：http://localhost:31001  
✅ 环境变量已配置：frontend/.env  

## 花生壳配置步骤

### 1. 下载并安装花生壳客户端
- 访问：https://www.oray.com/download/
- 下载Windows版本
- 安装并注册账号

### 2. 登录花生壳客户端
- 打开花生壳客户端
- 使用注册的账号登录

### 3. 配置内网穿透映射

#### 后端API映射
1. 点击"内网穿透"
2. 点击"添加映射"
3. 配置参数：
   - **应用名称**：智大蓝图后端
   - **内网主机**：127.0.0.1
   - **内网端口**：5000
   - **协议类型**：HTTP
   - **外网端口**：自动分配
   - **外网域名**：自动分配

#### 前端应用映射
1. 再次点击"添加映射"
2. 配置参数：
   - **应用名称**：智大蓝图前端
   - **内网主机**：127.0.0.1
   - **内网端口**：31001
   - **协议类型**：HTTP
   - **外网端口**：自动分配
   - **外网域名**：自动分配

### 4. 获取外网地址
配置完成后，花生壳会提供类似以下的外网地址：
- **后端API**：`http://xxxx-backend.vicp.net:端口`
- **前端应用**：`http://xxxx-frontend.vicp.net:端口`

### 5. 修改前端API配置
当您获得外网地址后，需要修改前端配置：

#### 方法一：修改环境变量（推荐）
编辑 `frontend/.env` 文件：
```bash
# 将原来的
REACT_APP_API_URL=http://localhost:5000

# 修改为花生壳后端地址
REACT_APP_API_URL=http://xxxx-backend.vicp.net:端口
```

然后重新构建前端：
```bash
cd frontend
npm run build
```

#### 方法二：直接修改代码
在 `frontend/src/App.jsx` 中找到API调用，将相对路径改为绝对路径。

### 6. 测试外网访问
- 使用花生壳提供的前端外网地址访问应用
- 测试各项功能是否正常

## 常见问题

### Q: 花生壳免费版限制？
A: 免费版限制：
- 映射数量：2个（刚好够用）
- 带宽限制：1Mbps
- 连接数：100个
- 域名：随机分配

### Q: 外网访问前端正常但API报错？
A: 99%是前端API地址没改对，请检查：
1. 前端环境变量中的API地址是否正确
2. 是否重新构建了前端
3. 花生壳后端映射是否正常

### Q: 如何检查映射是否正常？
A: 在花生壳客户端中查看：
1. 映射状态是否显示"在线"
2. 外网地址是否可以访问
3. 本地服务是否正常运行

## 一键启动脚本
如果您想使用一键启动脚本，可以运行：
```bash
双击 deploy/start-oray.bat
```

## 下一步
配置完成后，您就可以通过花生壳提供的外网地址访问智大蓝图应用了！

如有问题，请参考详细指南：`deploy/oray-guide.md` 